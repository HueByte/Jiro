version: "3.8"

services:
  jiro-kernel:
    container_name: jiro-kernel
    build:
      context: ./src/Jiro.Kernel
      dockerfile: Dockerfile
    environment:
      # Core application configuration
      - JIRO_ApiKey=${JIRO_ApiKey}
      
      # OpenAI configuration
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - JIRO_Chat__AuthToken=${OPENAI_API_KEY}
      - JIRO_Chat__SystemMessage=${JIRO_Chat__SystemMessage:-I want you to act as personal assistant called Jiro. You are friendly, funny and sarcastic. You can ask me anything you want and engage in conversation.}
      - JIRO_Chat__TokenLimit=${JIRO_Chat__TokenLimit:-2000}
      - JIRO_Chat__Enabled=${JIRO_Chat__Enabled:-true}
      
      # JiroCloud service configuration
      - JIRO_JiroCloud__ApiKey=${JIRO_ApiKey}
      - JIRO_JiroCloud__ApiUrl=${JIRO_JiroCloud__ApiUrl:-https://jiro.huebytes.com/api}
      - JIRO_JiroCloud__Grpc__ServerUrl=${JIRO_JiroCloud__Grpc__ServerUrl:-https://jiro.huebytes.com/grpc}
      - JIRO_JiroCloud__WebSocket__HubUrl=${JIRO_JiroCloud__WebSocket__HubUrl:-https://jiro.huebytes.com/hubs/instanceHub}
      
      # Database configuration (SQLite default)
      - JIRO_ConnectionStrings__JiroContext=${JIRO_ConnectionStrings__JiroContext:-Data Source=Data/Database/jiro.db}
    volumes:
      - jiro_data:/home/app/jiro/Data
    networks:
      - jiro-network
    restart: unless-stopped

  jiro-docs:
    container_name: jiro-docs
    build:
      context: .
      dockerfile: dev/Dockerfile
    ports:
      - "${JIRO_DOCS_PORT:-8081}:80"
    networks:
      - jiro-network
    restart: unless-stopped

volumes:
  jiro_data:
    driver: local

networks:
  jiro-network:
    driver: bridge
